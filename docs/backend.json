{
  "entities": {
    "Application": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Application",
      "type": "object",
      "description": "Represents a job application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the application."
        },
        "companyName": {
          "type": "string",
          "description": "Name of the company."
        },
        "companyLogoUrl": {
          "type": "string",
          "description": "URL of the company logo.",
          "format": "uri"
        },
        "position": {
          "type": "string",
          "description": "Job position applied for."
        },
        "applicationDate": {
          "type": "string",
          "description": "Date when the application was submitted.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the application (e.g., Applied, Interview, Offer, Rejected)."
        },
        "notes": {
          "type": "string",
          "description": "Rich-text notes about the application."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Application)"
        },
        "attachments": {
          "type": "array",
          "description": "array of url strings to attached files related to the application",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "companyName",
        "position",
        "applicationDate",
        "status",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "ResumeFeedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ResumeFeedback",
      "type": "object",
      "description": "Stores the AI feedback for a user's resume.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the resume feedback entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ResumeFeedback)"
        },
        "resumeFilename": {
          "type": "string",
          "description": "The name of the uploaded resume file."
        },
        "overallScore": {
          "type": "number",
          "description": "Overall score of the resume provided by the AI.",
          "format": "number"
        },
        "bulletPointSuggestions": {
          "type": "string",
          "description": "Bullet-point suggestions for improving the resume provided by the AI."
        },
        "keywordOptimizations": {
          "type": "string",
          "description": "Keyword optimization advice for the resume provided by the AI."
        }
      },
      "required": [
        "id",
        "userId",
        "resumeFilename"
      ]
    },
    "CoverLetter": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CoverLetter",
      "type": "object",
      "description": "Stores the cover letters generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cover letter."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CoverLetter)"
        },
        "resumeId": {
          "type": "string",
          "description": "Reference to ResumeFeedback. (Relationship: ResumeFeedback 1:N CoverLetter). Resume used to generate the cover letter."
        },
        "jobDescription": {
          "type": "string",
          "description": "Optional job description used for cover letter generation."
        },
        "coverLetterText": {
          "type": "string",
          "description": "The generated cover letter text."
        },
        "tone": {
          "type": "string",
          "description": "Tone of the cover letter (e.g., formal, informal)."
        }
      },
      "required": [
        "id",
        "userId",
        "resumeId",
        "coverLetterText",
        "tone"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The 'userId' parameter is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/applications/{applicationId}",
        "definition": {
          "entityName": "Application",
          "schema": {
            "$ref": "#/backend/entities/Application"
          },
          "description": "Stores job application data for each user. The 'userId' parameter ensures path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "applicationId",
              "description": "The unique identifier for the application."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/resumeFeedback/{resumeFeedbackId}",
        "definition": {
          "entityName": "ResumeFeedback",
          "schema": {
            "$ref": "#/backend/entities/ResumeFeedback"
          },
          "description": "Stores resume feedback data for each user. The 'userId' parameter ensures path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "resumeFeedbackId",
              "description": "The unique identifier for the resume feedback."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/coverLetters/{coverLetterId}",
        "definition": {
          "entityName": "CoverLetter",
          "schema": {
            "$ref": "#/backend/entities/CoverLetter"
          },
          "description": "Stores cover letter data for each user. The 'userId' parameter ensures path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "coverLetterId",
              "description": "The unique identifier for the cover letter."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, adhering to the core principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It primarily uses path-based ownership for user-related data. \n\n*   **Authorization Independence:** Achieved by using path-based ownership (`/users/{userId}/applications/{applicationId}`).  No `get()` calls are needed in security rules to determine ownership.  The `userId` is implicitly known from the path.\n*   **Clarity of Intent:** The structure clearly defines the relationships between users and their data (applications, resume feedback, cover letters) through hierarchical paths.\n*   **DBAC:** Authorization relies solely on `request.auth.uid` and the document paths. No custom claims are used.\n*   **QAPs:** List operations are secure because the data is segregated based on ownership. Rules can allow listing only within a user's own path.\n\nEach document will have `userId`, which is used as the main access check in the security rules."
  }
}